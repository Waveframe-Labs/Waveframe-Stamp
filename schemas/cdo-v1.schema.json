{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://waveframelabs.org/schemas/stamp-cdo-v1.json",
  "title": "Stamp Canonical Diagnostic Object v1",
  "description": "The immutable contract for structural diagnostics emitted by the Stamp engine.",
  "type": "object",
  "required": [
    "id",
    "severity",
    "schema_keyword",
    "instance_path",
    "schema_path",
    "message",
    "details",
    "provenance"
  ],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z_]+\\.[a-z_]+$",
      "description": "Deterministic identifier derived from keyword and failure class (e.g., required.missing)."
    },
    "severity": {
      "type": "string",
      "enum": ["error", "warning", "info"],
      "description": "Structural impact level. Defaults to 'error' for all validation failures."
    },
    "schema_keyword": {
      "type": "string",
      "pattern": "^[a-zA-Z][a-zA-Z0-9]*$",
      "description": "The specific JSON Schema keyword that triggered the diagnostic (e.g., required, additionalProperties)."
    },
    "instance_path": {
      "type": "string",
      "description": "RFC 6901 JSON Pointer to the location in the data where the failure occurred."
    },
    "schema_path": {
      "type": "string",
      "description": "RFC 6901 JSON Pointer to the constraint in the schema that was violated."
    },
    "message": {
      "type": "string",
      "description": "Human-readable, non-interpretive description of the failure."
    },
    "details": {
      "type": "object",
      "additionalProperties": true,
      "description": "Contextual data specific to the failure type."
    },
    "fix": {
      "type": ["object", "null"],
      "required": ["fixable", "strategy"],
      "properties": {
        "fixable": { "type": "boolean" },
        "strategy": { "type": "string", "enum": ["prune"] },
        "parameters": { "type": "object" }
      },
      "additionalProperties": false
    },
    "provenance": {
      "type": "object",
      "required": ["timestamp", "stamp_version"],
      "properties": {
        "timestamp": { "type": "string", "format": "date-time" },
        "stamp_version": { "type": "string" },
        "schema_version": { "type": "string" },
        "validator_engine": { "type": "string" }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}