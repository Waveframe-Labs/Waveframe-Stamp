{
  "title": "Stamp Normalization Proposal Object v1",
  "filetype": "schema",
  "type": "normative",
  "domain": "enforcement",
  "version": "0.1.0",
  "doi": "10.5281/zenodo.18436623",
  "status": "Active",
  "created": "2026-01-18",
  "updated": "2026-02-01",

  "author": {
    "name": "Shawn C. Wright",
    "email": "swright@waveframelabs.org",
    "orcid": "https://orcid.org/0009-0006-6043-9295"
  },

  "maintainer": {
    "name": "Waveframe Labs",
    "url": "https://waveframelabs.org"
  },

  "license": "Apache-2.0",

  "copyright": {
    "holder": "Waveframe Labs",
    "year": "2026"
  },

  "ai_assisted": "partial",
  "ai_assistance_details": "AI-assisted drafting of schema structure and proposal semantics under direct human architectural control; all epistemic boundaries and enforcement constraints finalized by the author.",

  "dependencies": [
    "STAMP-CDO-v1.0.0"
  ],

  "anchors": [
    "STAMP-NPO-v1.0.0"
  ],

  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://waveframelabs.org/schemas/stamp-npo-v1.schema.json",
  "description": "The immutable contract for normalization claims emitted by the Stamp engine. An NPO represents potential changes, not an executed transaction.",

  "type": "object",

  "required": [
    "npo_version",
    "stamp_version",
    "generated_at",
    "source_artifact",
    "schema_context",
    "proposals",
    "summary"
  ],

  "properties": {
    "npo_version": {
      "type": "string",
      "const": "1.0.0"
    },

    "stamp_version": {
      "type": "string",
      "description": "Version of the Stamp engine that generated this proposal."
    },

    "generated_at": {
      "type": "string",
      "format": "date-time"
    },

    "source_artifact": {
      "type": "object",
      "required": ["path"],
      "properties": {
        "path": { "type": "string" },
        "hash": {
          "type": "string",
          "description": "SHA-256 hash of the input artifact prior to normalization."
        }
      },
      "additionalProperties": false
    },

    "schema_context": {
      "type": "object",
      "required": ["id"],
      "properties": {
        "id": { "type": "string" },
        "uri": { "type": "string" }
      },
      "additionalProperties": false
    },

    "proposals": {
      "type": "array",
      "description": "A flat list of distinct normalization proposals derived from diagnostics.",
      "items": {
        "type": "object",
        "required": [
          "id",
          "diagnostic_id",
          "target",
          "action",
          "classification",
          "basis",
          "confidence",
          "requires_approval",
          "prohibited"
        ],
        "properties": {
          "id": {
            "type": "string",
            "pattern": "^[a-f0-9]{64}$",
            "description": "Deterministic SHA-256 hash of the proposal identity tuple."
          },

          "diagnostic_id": {
            "type": "string",
            "description": "Reference to the originating CDO identifier."
          },

          "target": {
            "type": "object",
            "required": ["instance_path", "schema_path"],
            "properties": {
              "instance_path": { "type": "string" },
              "schema_path": { "type": "string" }
            },
            "additionalProperties": false
          },

          "action": {
            "type": "string",
            "enum": ["add", "remove", "replace"],
            "description": "The atomic operation required to realize the proposal."
          },

          "current_value": {
            "description": "Observed value at the target path prior to normalization."
          },

          "proposed_value": {
            "description": "Proposed replacement or insertion value."
          },

          "classification": {
            "type": "string",
            "enum": ["mechanical", "inferred", "ambiguous", "prohibited"],
            "description": "Epistemic classification of the proposal."
          },

          "basis": {
            "type": "string",
            "enum": [
              "schema_strictness",
              "schema_default",
              "schema_enum_singleton",
              "case_normalization",
              "repository_history",
              "filename_convention",
              "policy_constraint",
              "manual_override"
            ],
            "description": "Primary reasoning source for the proposal."
          },

          "confidence": {
            "type": "string",
            "enum": ["high", "medium", "low"],
            "description": "Engine certainty level. Does not imply authority."
          },

          "requires_approval": {
            "type": "boolean",
            "description": "If true, proposal MUST NOT be applied without explicit authorization."
          },

          "prohibited": {
            "type": "boolean",
            "description": "If true, proposal represents a negative or forbidden claim."
          },

          "notes": {
            "type": "string"
          }
        },
        "additionalProperties": false
      }
    },

    "summary": {
      "type": "object",
      "required": ["total_proposals", "requires_approval_count"],
      "properties": {
        "total_proposals": { "type": "integer", "minimum": 0 },
        "requires_approval_count": { "type": "integer", "minimum": 0 },
        "by_classification": {
          "type": "object",
          "properties": {
            "mechanical": { "type": "integer" },
            "inferred": { "type": "integer" },
            "ambiguous": { "type": "integer" },
            "prohibited": { "type": "integer" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },

  "additionalProperties": false
}
